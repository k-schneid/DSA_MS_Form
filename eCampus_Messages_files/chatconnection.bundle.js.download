define("pets-client-chat/1.10.0/public/javascript/chatapi", ["pets-client-core/2.6.0/public/javascript/utility","pets-client-core/2.6.0/public/javascript/petsconfig!stringresources","pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/externalevent"],function(a,b,c,d){function e(){return N}function f(c){var d,e,f=c.indexOf(Q),g={name:c,displayName:c,type:P.Course,teamName:null,classId:null};return c===b.MY_FRIENDS_GROUP_NAME?g.type=P.Personal:f>0&&(e=c.substring(0,f),f=c.indexOf(R),g.type=P.LearningTeam,d=c.substring(f+1).slice(0,-1).split(S),g.teamName=d[0],g.classId=d[1],e+=" - "+g.teamName,g.displayName=a.truncate(25,e,"...")),g}function g(a,b){var c=b;return a&&a.length>0&&(c=a+"|"+c),c.replace(/\//g,"~").replace(/ /g,"_").replace(/\(/g,"{").replace(/:/g,"=").replace(/\)/g,"}").toLowerCase()}function h(a){return a.replace(/(^.*\|)|(@.*$)/g,"").replace(/\{/g,"(").replace(/=/g,":").replace(/\}/g,")").replace(/_/g," ").replace(/~/g,"/").replace(/(.*\/)*\b\w/g,function(a){return a.toUpperCase()})}function i(a){return c.trace("Pets-Client-Core::ChatApi::connectRequested"),d.subscribe(O.ConnectRequested,a)}function j(a){return c.trace("Pets-Client-Core::ChatApi::disconnectRequested"),d.subscribe(O.DisconnectRequested,a)}function k(a){return c.trace("Pets-Client-Core::ChatApi::rosterRequested"),d.subscribe(O.RosterRequested,a)}function l(a){return c.trace("Pets-Client-Core::ChatApi::connectionChanged"),d.subscribe(O.ConnectionChanged,a)}function m(a){d.unsubscribe(O.ConnectionChanged,a)}function n(a){return c.trace("Pets-Client-Core::ChatApi::userJoinedMuc"),d.subscribe(O.UserJoinedMuc,a)}function o(a){return c.trace("Pets-Client-Core::ChatApi::CreateChat"),d.subscribe(O.CreateChat,a)}function p(a){return c.trace("Pets-Client-Core::ChatApi::CreateMuc"),d.subscribe(O.CreateMuc,a)}function q(a){return c.trace("Pets-Client-Core::ChatApi::CreateNamedMuc"),d.subscribe(O.CreateNamedMuc,a)}function r(a){return c.trace("Pets-Client-Core::ChatApi::AddUsersToMuc"),d.subscribe(O.AddUsersToMuc,a)}function s(a){return c.trace("Pets-Client-Core::ChatApi::LeaveMuc"),d.subscribe(O.LeaveMuc,a)}function t(a){return c.trace("Pets-Client-Core::ChatApi::roomRequested"),d.subscribe(O.MucRoomRequested,a)}function u(a){return c.trace("Pets-Client-Core::ChatApi::roomCreated"),d.subscribe(O.MucRoomCreated,a)}function v(a){return c.trace("Pets-Client-Core::ChatApi::roomInvalidated"),d.subscribe(O.MucRoomInvalidated,a)}function w(a){return c.trace("PETs-Client-Core::ChatApi::JoinMucRoom"),d.subscribe(O.JoinMucRoom,a)}function x(a){return c.trace("Pets-Client-Core::ChatApi::unreadMessageCountChanged"),d.subscribe(O.UnreadMessageCountChanged,a)}function y(){c.trace("Pets-Client-Core::ChatApi::postConnectRequested"),d.publish(O.ConnectRequested)}function z(a){c.trace("Pets-Client-Core::ChatApi::postDisconnectRequested"),d.publish(O.DisconnectRequested,{connectionErrorCondition:a})}function A(){c.trace("Pets-Client-Core::ChatApi::postRosterRequested"),d.publish(O.RosterRequested)}function B(a,b,e,f,g){c.trace("Pets-Client-Core::ChatApi::postConnectionChanged"),N=b,d.publish(O.ConnectionChanged,{jid:a,statusCode:b,statusCodeText:e,errorCondition:f,errorConditionText:g})}function C(a){c.trace("Pets-Client-Core::ChatApi::postUserJoinedMuc"),d.publish(O.UserJoinedMuc,{room:a})}function D(a){c.trace("Pets-Client-Core::ChatApi::createChat"),d.publish(O.CreateChat,{participants:a})}function E(a){c.trace("Pets-Client-Core::ChatApi::createMuc"),d.publish(O.CreateMuc,{participants:a})}function F(a,b,e){c.trace("Pets-Client-Core::ChatApi::createNamedMuc"),d.publish(O.CreateNamedMuc,{namespace:a,name:b,participants:e})}function G(a,b){c.trace("Pets-Client-Core::ChatApi::addUsersToMuc"),d.publish(O.AddUsersToMuc,{room:a,participants:b})}function H(a){c.trace("Pets-Client-Core::ChatApi::leaveMuc"),d.publish(O.LeaveMuc,{room:a})}function I(){c.trace("Pets-Client-Core::ChatApi::postMucRoomRequested"),d.publish(O.MucRoomRequested)}function J(a){c.trace("Pets-Client-Core::ChatApi::postMucRoomCreated"),d.publish(O.MucRoomCreated,{room:a})}function K(a){c.trace("Pets-Client-Core::ChatApi::postMucRoomInvalidated"),d.publish(O.MucRoomInvalidated,{room:a})}function L(a){c.trace("PETs-Client-Core::ChatApi::postJoinMucRoom"),d.publish(O.JoinMucRoom,{room:a})}function M(a){c.trace("Pets-Client-Core::ChatApi::postUnreadMessageCountChanged"),d.publish(O.UnreadMessageCountChanged,{unreadMessageCount:a})}c.trace("Pets-Client-Core::ChatApi::ctor");var N,O={ConnectRequested:"edu.apollogrp.pln.pets.core.chatapi.connectrequested",DisconnectRequested:"edu.apollogrp.pln.pets.core.chatapi.disconnectrequested",RosterRequested:"edu.apollogrp.pln.pets.core.chatapi.rosterrequested",ConnectionChanged:"edu.apollogrp.pln.pets.core.chatapi.connectionchanged",UserJoinedMuc:"edu.apollogrp.pln.pets.core.chatapi.userjoinedmuc",CreateChat:"edu.apollogrp.pln.pets.core.chatapi.createchat",CreateMuc:"edu.apollogrp.pln.pets.core.chatapi.createmuc",CreateNamedMuc:"edu.apollogrp.pln.pets.core.chatapi.createnamedmuc",AddUsersToMuc:"edu.apollogrp.pln.pets.core.chatapi.adduserstomuc",LeaveMuc:"edu.apollogrp.pln.pets.core.chatapi.leavemuc",MucRoomRequested:"edu.apollogrp.pln.pets.core.chatapi.mucroomrequested",MucRoomCreated:"edu.apollogrp.pln.pets.core.chatapi.mucroomcreated",MucRoomInvalidated:"edu.apollogrp.pln.pets.core.chatapi.mucroominvalidated",JoinMucRoom:"edu.apollogrp.pln.pets.core.chatapi.joinmucroom",UnreadMessageCountChanged:"edu.apollogrp.pln.pets.core.chatapi.unreadmessagecountchanged"},P={Personal:"Personal",LearningTeam:"LearningTeam",Course:"Course"},Q=" - Team (",R="(",S=":";return{GroupTypes:P,jidify:g,dejidify:h,getContactGroupInfo:f,getConnectionStatus:e,connectRequested:i,disconnectRequested:j,rosterRequested:k,connectionChanged:l,unsubscribeConnectionChanged:m,userJoinedMuc:n,createChat:o,createMuc:p,createNamedMuc:q,addUsersToMuc:r,leaveMuc:s,mucRoomRequested:t,mucRoomCreated:u,mucRoomInvalidated:v,joinMucRoom:w,unreadMessageCountChanged:x,postConnectRequested:y,postDisconnectRequested:z,postRosterRequested:A,postConnectionChanged:B,postUserJoinedMuc:C,postCreateChat:D,postCreateMuc:E,postCreateNamedMuc:F,postAddUsersToMuc:G,postLeaveMuc:H,postMucRoomRequested:I,postMucRoomCreated:J,postMucRoomInvalidated:K,postJoinMucRoom:L,postUnreadMessageCountChanged:M}});

define("pets-client-chat/1.10.0/public/javascript/chatstateenum", [],{Gone:0,Inactive:1,Active:2,Composing:3,Paused:4});

define("pets-client-chat/1.10.0/public/javascript/chattypeenum", [],{OneOnOne:"chat",Muc:"groupchat"});

define("pets-client-chat/1.10.0/public/javascript/connectionerrorconditionenum", [],{Unknown:-1,Conflict:0,UserUnknown:1,None:2});

define("pets-client-chat/1.10.0/public/javascript/connectioninfocache", ["pets-client-core/2.6.0/public/javascript/petsconfig!pets","pets-client-core/2.6.0/public/javascript/petsconfig!pets-client-chat/1.10.0/public/config/chat"],function(a,b){function c(){0===k.window&&(k.window=1,e(k.jid,k.sid,k.rid))}function d(a,b){var c={};if(k.jid)c=k;else{var d=i(j);if(d){var e=d.split("|");3===e.length&&(c.window=parseInt(e[0]),k.rid=c.rid=e[1]?e[1]:null,k.sid=c.sid=e[2]?e[2]:null,k.jid=a)}}b(c)}function e(a,b,c){k.jid=a,k.sid=b,k.rid=c;var d=1===k.window?1:0,e=d+"|"+(k.rid?k.rid:"")+"|"+(k.sid?k.sid:"");g(j,e)}function f(){k.jid=k.sid=k.rid=null,k.window=0}function g(b,c,d){var e=b+"="+c+"; path=/; domain="+a.cacheProxy.cookieDomain,f="; secure";if("undefined"!=typeof d){var g=new Date;g.setTime(g.getTime()+24*d*60*60*1e3),f="; expires="+g.toGMTString()+f}document.cookie=e+f}function h(){k.window=0,e(k.jid,k.sid,k.rid)}function i(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}var j=b.connectionInfoCookieName,k={jid:null,sid:null,rid:null,window:0};return"undefined"==typeof window.addEventListener?"undefined"!=typeof window.attachEvent&&(window.attachEvent("onbeforeunload",c),window.attachEvent("onunload",c)):(window.addEventListener("beforeunload",c,!1),window.addEventListener("unload",c,!1)),{set:e,get:d,clear:f,resetWindow:h}});

define("pets-client-chat/1.10.0/public/javascript/connectionstatusenum", [],{Unknown:-1,Connecting:0,ConnectionFailed:1,Authenticating:2,AuthenticationFailed:3,Connected:4,Disconnected:5,Disconnecting:6,Attached:7,Error:8});

define("pets-client-chat/1.10.0/public/javascript/contactsapi", ["pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/externalevent"],function(a,b){function c(c){return a.trace("Pets-Client-Core::ContactsApi::contactsReceived"),b.subscribe(m.ContactsReceived,c)}function d(c){return a.trace("Pets-Client-Core::ContactsApi::contactsAdded"),b.subscribe(m.ContactAdded,c)}function e(c){return a.trace("Pets-Client-Core::ContactsApi::contactUpdated"),b.subscribe(m.ContactUpdated,c)}function f(c){return a.trace("Pets-Client-Core::ContactsApi::contactRemoved"),b.subscribe(m.ContactRemoved,c)}function g(c){return a.trace("Pets-Client-Core::ContactsApi::contactChanged"),b.subscribe(m.ContactChanged,c)}function h(c,d){a.trace("Pets-Client-Core::ContactsApi::postContactsReceived"),b.publish(m.ContactsReceived,{contacts:c,contactGroups:d})}function i(c,d,e){a.trace("Pets-Client-Core::ContactsApi::postContactAdded"),b.publish(m.ContactAdded,{jid:c,contacts:d,contactGroups:e})}function j(c,d,e){a.trace("Pets-Client-Core::ContactsApi::postContactUpdated"),b.publish(m.ContactUpdated,{jid:c,contacts:d,contactGroups:e})}function k(c){a.trace("Pets-Client-Core::ContactsApi::postContactRemoved"),b.publish(m.ContactRemoved,{jid:c})}function l(c,d,e,f){a.trace("Pets-Client-Core::ContactsApi::postContactChanged"),b.publish(m.ContactChanged,{jid:c,name:d,avatarUrl:e,groups:f})}a.trace("Pets-Client-Core::ContactEvents::ctor");var m={ContactsReceived:"edu.apollogrp.pln.pets.core.contactsapi.contactsreceived",ContactAdded:"edu.apollogrp.pln.pets.core.contactsapi.contactadded",ContactUpdated:"edu.apollogrp.pln.pets.core.contactsapi.contactupdated",ContactRemoved:"edu.apollogrp.pln.pets.core.contactsapi.contactremoved",ContactChanged:"edu.apollogrp.pln.pets.core.contactsapi.contactchanged"};return{contactsReceived:c,contactAdded:d,contactUpdated:e,contactRemoved:f,contactChanged:g,postContactsReceived:h,postContactAdded:i,postContactUpdated:j,postContactRemoved:k,postContactChanged:l}});

define("pets-client-chat/1.10.0/public/javascript/contactsinfocache", ["pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/cacheproxy"],function(a,b){function c(c,d){a.trace("PETs-Client-Chat::ContactsInfoCache::get"),b.getCache(e.ContactsInfo+c).snapshot(d)}function d(c,d){a.trace("PETs-Client-Chat::ContactsInfoCache::set"),b.getCache(e.ContactsInfo+c).set(d)}a.trace("PETs-Client-Chat::ContactsInfoCache::ctor");var e={ContactsInfo:"contactsinfocache.contactsinfo."};return{get:c,set:d}});

define("pets-client-chat/1.10.0/public/javascript/messagingapi", ["pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/externalevent"],function(a,b){function c(c){return a.trace("Pets-Client-Core::MessagingApi::sendMessage"),b.subscribe(k.SendMessage,c)}function d(c){return a.trace("Pets-Client-Core::MessagingApi::messageSent"),b.subscribe(k.MessageSent,c)}function e(c){return a.trace("Pets-Client-Core::MessagingApi::messageReceived"),b.subscribe(k.MessageReceived,c)}function f(c){return a.trace("Pets-Client-Core::MessagingApi::mucMessageReceived"),b.subscribe(k.MucMessageReceived,c)}function g(c,d,e,f){a.trace("Pets-Client-Core::MessagingApi::postSendMessage"),b.publish(k.SendMessage,{id:c,body:e,html:f,address:d})}function h(c){a.trace("Pets-Client-Core::MessagingApi::postMessageSent"),b.publish(k.MessageSent,{id:c})}function i(c,d,e,f){a.trace("Pets-Client-Core::MessagingApi::postMessageReceived"),b.publish(k.MessageReceived,{from:c,body:d,sentDateTime:e,isHistoric:f})}function j(c,d,e,f,g){a.trace("Pets-Client-Core::MessagingApi::postMucMessageReceived"),b.publish(k.MucMessageReceived,{room:c,from:d,body:e,sentDateTime:f,isHistoric:g})}a.trace("Pets-Client-Core::MessagingApi::ctor");var k={SendMessage:"edu.apollogrp.pln.pets.core.messagingapi.sendmessage",MessageSent:"edu.apollogrp.pln.pets.core.messagingapi.messagesent",MessageReceived:"edu.apollogrp.pln.pets.core.messagingapi.messagereceived",MucMessageReceived:"edu.apollogrp.pln.pets.core.messagingapi.mucmessagereceived"};return{sendMessage:c,messageSent:d,messageReceived:e,mucMessageReceived:f,postSendMessage:g,postMessageSent:h,postMessageReceived:i,postMucMessageReceived:j}});

define("pets-client-chat/1.10.0/public/javascript/prebind", ["ncf-thirdparty/jquery-1.7.1/public/javascript/jquery","pets-client-core/2.6.0/public/javascript/petsconfig!pets-client-chat/1.10.0/public/config/chat","pets-client-core/2.6.0/public/javascript/logger"],function(a,b,c){function d(f,g){function h(a){e>0?(c.warning("PETs-Client-Chat::prebind::connect::onError","Error occurred while performing prebind attach: "+a.status+", "+a.statusText+". Retrying, attempt #"+(b.prebind.tryLimit-e)+" of "+b.prebind.tryLimit+"..."),setTimeout(function(){d(f,g)},Math.pow(2,b.prebind.tryLimit-e)*b.prebind.retryWait)):(c.error("PETs-Client-Chat::prebind::connect::onError","Could not prebind attach to chat server; retry count exhausted; fatal error: "+a.status+", "+a.statusText),e=b.prebind.tryLimit,g(null,null))}function i(d){var f,i=null,j=null;c.info("PETs-Client-Core::prebind::connect::onSuccess","Prebind attached to chat server."),a.browser.msie?d.result.success?(i=d.result.data.sid,j=d.result.data.rid):h({status:"Invalid server response",statusText:d.result.data}):(f=a(d).find("body"),f.length>0&&(i=f.attr("sid"),j=f.attr("rid"))),c.info("PETS-Client-Core::prebind::connect::onSuccess","Attached; sid/rid: "+i+", "+j),e=b.prebind.tryLimit,g(i,j)}e--;var j={type:"POST",cache:!1,timeout:b.prebind.timeOut,success:i,error:h};a.browser.msie?(j.url=b.prebind.url.cds,j.contentType="text/json",j.data={}):(j.url=b.prebind.url.xmpp,j.contentType="text/xml",j.data='<?xml version="1.0" encoding="utf-8"?><body jid="'+f+'" wait="60" hold="1"/>',j.xhrFields={withCredentials:!0}),a.ajax(j)}var e=b.prebind.tryLimit;return{connect:d}});

define("pets-client-chat/1.10.0/public/javascript/presenceapi", ["pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/utility","pets-client-core/2.6.0/public/javascript/externalevent"],function(a,b,c){function d(b){return a.trace("Pets-Client-Core::PresenceApi::selfPresenceChanged"),c.subscribe(v.SelfPresenceChanged,b)}function e(b){return a.trace("Pets-Client-Core::PresenceApi::presenceChanged"),c.subscribe(v.PresenceChanged,b)}function f(b){return a.trace("Pets-Client-Core::PresenceApi::presenceChangeRequested"),c.subscribe(v.PresenceChangeRequested,b)}function g(b){return a.trace("Pets-Client-Core::PresenceApi::mucPresenceChanged"),c.subscribe(v.MucPresenceChanged,b)}function h(b){return a.trace("Pets-Client-Core::PresenceApi::mucPresenceChangeRequested"),c.subscribe(v.MucPresenceChangeRequested,b)}function i(b){return a.trace("Pets-Client-Core::PresenceApi::stateChanged"),c.subscribe(v.StateChanged,b)}function j(b){return a.trace("Pets-Client-Core::PresenceApi::stateChangeRequested"),c.subscribe(v.StateChangeRequested,b)}function k(b){return a.trace("Pets-Client-Core::PresenceApi::mucStateChanged"),c.subscribe(v.MucStateChanged,b)}function l(b){return a.trace("Pets-Client-Core::PresenceApi::mucStateChangeRequested"),c.subscribe(v.MucStateChangeRequested,b)}function m(b,d,e,f){a.trace("Pets-Client-Core::PresenceApi::postPresenceChanged"),c.publish(v.PresenceChanged,{from:b,presence:d,presenceText:e,status:f})}function n(b,d,e,f){a.trace("Pets-Client-Core::PresenceApi::postSelfPresenceChanged"),c.publish(v.SelfPresenceChanged,{from:b,presence:d,presenceText:e,status:f})}function o(b,d,e){a.trace("Pets-Client-Core::PresenceApi::postPresenceChangeRequested"),c.publish(v.PresenceChangeRequested,{presence:b,address:d,status:e})}function p(b,d,e,f,g,h){a.trace("Pets-Client-Core::PresenceApi::postMuchPresenceChanged"),c.publish(v.MucPresenceChanged,{room:b,from:d,presence:e,presenceText:f,name:g,status:h})}function q(b,d,e){a.trace("Pets-Client-Core::PresenceApi::postMucPresenceChangeRequested"),c.publish(v.MucPresenceChangeRequested,{room:b,jid:d,presence:e})}function r(b,d,e){a.trace("Pets-Client-Core::PresenceApi::postStateChanged"),c.publish(v.StateChanged,{jid:b,state:d,stateText:e})}function s(b,d){a.trace("Pets-Client-Core::PresenceApi::postStateChangeRequested"),c.publish(v.StateChangeRequested,{state:b,address:d})}function t(b,d,e,f){a.trace("Pets-Client-Core::PresenceApi::postMucStateChanged"),c.publish(v.MucStateChanged,{room:b,jid:d,state:e,stateText:f})}function u(b,d,e){a.trace("Pets-Client-Core::PresenceApi::postMucStateChangeRequested"),c.publish(v.MucStateChangeRequested,{room:b,jid:d,state:e})}a.trace("Pets-Client-Core::PresenceApi::ctor");var v={SelfPresenceChanged:"edu.apollogrp.pln.pets.core.presenceapi.selfpresencechanged",PresenceChanged:"edu.apollogrp.pln.pets.core.presenceapi.presencechanged",PresenceChangeRequested:"edu.apollogrp.pln.pets.core.presenceapi.presencechangerequested",MucPresenceChanged:"edu.apollogrp.pln.pets.core.presenceapi.mucpresencechanged",MucPresenceChangeRequested:"edu.apollogrp.pln.pets.core.presenceapi.mucpresencechangerequested",StateChanged:"edu.apollogrp.pln.pets.core.presenceapi.statechanged",StateChangeRequested:"edu.apollogrp.pln.pets.core.presenceapi.statechangerequested",MucStateChanged:"edu.apollogrp.pln.pets.core.presenceapi.mucstatechanged",MucStateChangeRequested:"edu.apollogrp.pln.pets.core.presenceapi.mucstatechangerequested"};return{selfPresenceChanged:d,presenceChanged:e,presenceChangeRequested:f,mucPresenceChanged:g,mucPresenceChangeRequested:h,stateChanged:i,stateChangeRequested:j,mucStateChanged:k,mucStateChangeRequested:l,postSelfPresenceChanged:n,postPresenceChanged:m,postPresenceChangeRequested:o,postMucPresenceChanged:p,postMucPresenceChangeRequested:q,postStateChanged:r,postStateChangeRequested:s,postMucStateChanged:t,postMucStateChangeRequested:u}});

define("pets-client-chat/1.10.0/public/javascript/presenceenum", [],{Unknown:-1,Offline:0,ExtendedAway:2,Away:3,DoNotDisturb:4,Available:5});

define("pets-client-chat/1.10.0/public/javascript/stropheproxy", ["pets-client-thirdparty/1.4.1/public/javascript/stropheloader!justload"],function(a){return function(){return{strophe:a,build:function(b,c){return new a.Builder(b,c)},msg:function(b){return new a.Builder("message",b)},iq:function(b){return new a.Builder("iq",b)},pres:function(b){return new a.Builder("presence",b)}}}()});

define("pets-client-chat/1.10.0/public/javascript/xmpperrorconditionenum", [],{Conflict:"conflict",None:"none"});

define("pets-client-chat/1.10.0/public/javascript/security", ["pets-client-core/2.6.0/public/javascript/petsconfig!pets","pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/utility","pets-client-core/2.6.0/public/javascript/userinfo","pets-client-chat/1.10.0/public/javascript/connectioninfocache"],function(a,b,c,d,e){function f(b){var f=d.getPetsId(),g=f+"/apollo-webclient",h="SSO-"+c.cookieHelper.get(a.ssoCookieName);e.get(f,function(a){var c={};c.authToken=h,c.bareJid=f,c.jid=g,c.sid=a.sid,c.rid=a.rid,c.window=a.window,b(c)})}return b.trace("Pets-Client-Core::Security::ctor"),{getSecurityContext:f}});

define("pets-client-chat/1.10.0/public/javascript/chatconnection.bundle", ["ncf-thirdparty/jquery-1.7.1/public/javascript/jquery","pets-client-core/2.6.0/public/javascript/utility","pets-client-core/2.6.0/public/javascript/logger","pets-client-core/2.6.0/public/javascript/petsconfig!pets-client-chat/1.10.0/public/config/chat","pets-client-core/2.6.0/public/javascript/cachedqueue","pets-client-core/2.6.0/public/javascript/userinfo","pets-client-core/2.6.0/public/javascript/cdsapi","pets-client-core/2.6.0/public/javascript/cacheproxy","pets-client-core/2.6.0/public/javascript/analyticseventsenum","pets-client-core/2.6.0/public/javascript/analytics","pets-client-chat/1.10.0/public/javascript/chatapi","pets-client-chat/1.10.0/public/javascript/messagingapi","pets-client-chat/1.10.0/public/javascript/presenceapi","pets-client-chat/1.10.0/public/javascript/contactsapi","pets-client-chat/1.10.0/public/javascript/connectionstatusenum","pets-client-chat/1.10.0/public/javascript/connectionerrorconditionenum","pets-client-chat/1.10.0/public/javascript/xmpperrorconditionenum","pets-client-chat/1.10.0/public/javascript/presenceenum","pets-client-chat/1.10.0/public/javascript/chatstateenum","pets-client-chat/1.10.0/public/javascript/chattypeenum","pets-client-chat/1.10.0/public/javascript/security","pets-client-chat/1.10.0/public/javascript/prebind","pets-client-chat/1.10.0/public/javascript/stropheproxy","pets-client-chat/1.10.0/public/javascript/connectioninfocache","pets-client-chat/1.10.0/public/javascript/contactsinfocache"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(){c.trace("Pets-Client-Chat::ChatConnection::onConnectRequested"),zb.isSetOffline=!1,h.getCache(Db+yb).set(zb),O(),L()}function A(){c.trace("Pets-Client-Chat::ChatConnection::onDisconnectRequested"),zb.isSetOffline=!0,h.getCache(Db+yb).set(zb),N("user option")}function B(a,b){c.trace("Pets-Client-Chat::ChatConnection::onSendMessage","",b),Q(["id","body","address"],b,"onSendMessage")&&(Gb.connected?S(b.address,b.body,b.html):Bb.enqueue(yb,b))}function C(a,d){c.trace("Pets-Client-Chat::ChatConnection::onStateChangeRequested","",d);var e=b.checkParameterObject(["state"],d);return e.length>0?void c.error("Pets-Client-Chat::ChatConnection::onStateChangeRequested","There was an error while calling onStateChangeRequested\r\n"+e):void W(d.state,d.address)}function D(a,d){c.trace("Pets-Client-Chat::ChatConnection::onPresenceChangeRequested","",d),X(d.presence,d.address,d.status),b.isUndefinedOrNull(d.status)||g.saveSelfStatus(d.status)}function E(a,b){c.trace("Pets-Client-Chat::ChatConnection::onCreateMuc","",b),Q(["participants"],b,"onCreateMuc")&&T(b.participants)}function F(a,b){c.trace("Pets-Client-Chat::ChatConnection::onCreateNamedMuc","",b),Q(["name","participants"],b,"onCreateNamedMuc")&&U(b.namespace,b.name,b.participants)}function G(a,b){c.trace("Pets-Client-Chat::ChatConnection::onJoinMucRoom","",b),_(b.room)}function H(a,b){c.trace("Pets-Client-Chat::ChatConnection::onAddUsersToMuc","",b),Q(["room","participants"],b,"onAddUsersToMuc")&&V(b.room,b.participants)}function I(a,b){c.trace("Pets-Client-Chat::ChatConnection::onLeaveMuc","",b),Q(["room"],b,"onLeaveMuc")&&Y(b.room)}function J(){c.trace("Pets-Client-Chat::ChatConnection::setupStanzaHandlers"),Gb.addHandler(vb,null,"presence"),Gb.addHandler(vb,Fb.NS.MUC,"presence"),Gb.addHandler(sb,Fb.NS.ROSTER,"iq","set"),Gb.addHandler(wb,null,"message","chat"),Gb.addHandler(wb,null,"message","groupchat"),Gb.addHandler(xb,Fb.NS.MUC+"#user","message"),Gb.addHandler(xb,"jabber:x:conference","message"),Gb.addHandler(ub,"http://jabber.org/protocol/chatstates","message")}function K(a,c){b.isUndefinedOrNull(zb)?h.getCache(Db+a).snapshot(function(a){zb=b.isUndefinedOrNull(a)?{isSetOffline:!1}:a,c(zb)}):c(zb)}function L(a){c.trace("Pets-Client-Chat::ChatConnection::connect"),u.getSecurityContext(function(e){yb=e.bareJid,K(yb,function(h){zb.isSetOffline=h.isSetOffline,zb.isSetOffline?Gb.connected?N("user option"):setTimeout(function(){var a={statusCode:o.Disconnected,errorCondition:p.None,errorConditionText:q.None};k.postConnectionChanged(yb,a.statusCode,b.getObjPropNameByValue(o,a.statusCode),a.errorCondition,a.errorConditionText)},2e3):1===e.window&&e.jid&&e.sid&&e.rid&&0===Cb?(c.info("Pets-Client-Chat::ChatConnection::connect","Attaching to existing session..."),M(e,a)):(c.trace("Pets-Client-Chat::ChatConnection::connect","status = "+Hb),Hb||g.getSelfStatus(f.getUsername(),function(a){Hb=a,c.info("Pets-Client-Chat::ChatConnection::connect","status from CDS = "+Hb)}),d.prebind.enabled?(c.trace("Pets-Client-Chat::ChatConnection::connect","Creating prebind session..."),v.connect(e.jid,function(d,e){b.isUndefinedOrNull(d)||b.isUndefinedOrNull(e)?k.postConnectionChanged(yb,o.Disconnected,b.getObjPropNameByValue(o,o.Disconnected),p.Unknown,"prebind failed"):(Kb=!0,c.info("Pets-Client-Chat::ChatConnection::connect","Attaching to prebind ("+d+", "+e+") session..."),M({jid:yb,sid:d,rid:e},a))})):(c.info("Pets-Client-Chat::ChatConnection::connect","Connecting to new session..."),Gb.connect(e.jid,e.authToken,function(b,c){qb(b,c,a)})))})})}function M(a,b){c.trace("Pets-Client-Chat::ChatConnection::attach"),Gb.attach(a.jid,a.sid,a.rid,function(a,c){qb(a,c,b)})}function N(a){c.trace("Pets-Client-Chat::ChatConnection::disconnect ("+a+")"),Gb.sync=!0,Gb.flush(),Gb.disconnect(a)}function O(){c.trace("Pets-Client-Chat::ChatConnection::resetConnection"),Gb.reset()}function P(){c.trace("Pets-Client-Chat::ChatConnection::retryConnect");var a=++Cb;a<d.connectRetryLimit?(c.info("Pets-Client-Chat::ChatConnection::retryConnect",b.formatString("Attempting to reconnect to server (attempt #{0} of {1}).",a,d.connectRetryLimit)),O(),L()):(c.fatal("Pets-Client-Chat::ChatConnection::retryConnect","Could not reconnect to chat server."),ob())}function Q(a,d,e){c.trace("Pets-Client-Chat::ChatConnection::functionParametersAreValid");var f=b.checkParameterObject(a,d);return f.length>0?(c.error("Pets-Client-Chat::ChatConnection::onSendMessage","There was an error while calling ChatConnection::"+e+"\r\n"+f),!1):!0}function R(){c.trace("Pets-Client-Chat::ChatConnection::requestRoster");var a=w.iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});Gb.sendIQ(a,rb)}function S(a,d,e){c.trace("Pets-Client-Chat::ChatConnection::sendMessage");var f=w.msg({from:Gb.jid,to:a,type:ab(a)}).c("body",null,d);!b.isUndefinedOrNull(e)&&e.length>0&&(f=f.c("html",{xmlns:"http://jabber.org/protocol/xhtml-im"},e)),Gb.send(f)}function T(a){if(c.trace("Pets-Client-Chat::ChatConnection::createMuc"),b.isUndefinedOrNull(a)||a.length<=0)return null;var d=jb();return Gb.send(w.pres({to:db(d),from:Gb.jid}).c("x",{xmlns:Fb.NS.MUC})),Ib.push({room:d,participants:a}),d}function U(a,d,e){if(c.trace("Pets-Client-Chat::ChatConnection::createNamedMuc"),b.isUndefinedOrNull(e)||e.length<=0)return null;var f=jb(a,d),g=b.searchObjectArray(Ib,"room",f);return Gb.send(w.pres({to:db(f),from:Gb.jid}).c("x",{xmlns:Fb.NS.MUC})),g>=0?Ib[g].participants=e:Ib.push({room:f,participants:e}),f}function V(b,d){c.trace("Pets-Client-Chat::ChatConnection::addUsersToMuc"),a.isArray(d)||(d=[d]),ib(b,d)}function W(a,d){c.trace("Pets-Client-Chat::ChatConnection::changeState("+a+", "+d+")");var e,f={};switch(f.from=Gb.jid,f.type="chat",b.isUndefinedOrNull(d)||(f.to=d,bb(d)&&(f.type="groupchat")),a){case s.Gone:e="gone";break;case s.Inactive:e="inactive";break;case s.Active:e="active";break;case s.Composing:e="composing";break;case s.Paused:e="paused"}Gb.send(w.msg(f).c(e,{xmlns:"http://jabber.org/protocol/chatstates"})),Gb.flush()}function X(a,d,e){c.trace("Pets-Client-Chat::ChatConnection::changePresence("+a+", "+d+", "+e+")");var f,g={},h="";if(Gb.connected){if(!b.isUndefinedOrNull(a))switch(a){case r.ExtendedAway:h="xa";break;case r.Away:h="away";break;case r.DoNotDisturb:h="dnd";break;case r.Offline:g.type="unavailable"}b.isUndefinedOrNull(d)||(g.to=d,bb(d)&&a!==r.Offline&&(g.type="groupchat")),f=w.pres(g),h.length>0&&(f=f.c("show",null).t(h).up()),b.isUndefinedOrNull(e)||(f=f.c("status").t(e).up()),Gb.send(f),Gb.flush()}}function Y(a){c.trace("Pets-Client-Chat::ChatConnection::leaveMuc"),Gb.send(w.pres({to:db(a),type:"unavailable"}))}function Z(){var a,c;b.isUndefinedOrNull(Ab)&&(a=Fb.getBareJidFromJid(Gb.jid),c=Eb+a,h.getCache(c).snapshot(function(d){b.isUndefinedOrNull(d)?$(a,function(a,b,d,e,f){Ab={id:a,nickName:d,avatarUrl:e,profileUrl:f},h.getCache(c).set(Ab)}):Ab=d}))}function $(b,d){c.trace("Pets-Client-Chat::ChatConnection::requestVCard"),Gb.sendIQ(w.iq({to:b,type:"get",id:Gb.getUniqueId("rosterVCard")}).c("vCard",{xmlns:"vcard-temp"}),function(b){var c=a(b).find("vCard");d(c.find("JABBERID").text(),c.find("UID").text(),c.find("NICKNAME").text(),c.find("PHOTO > EXTVAL").text(),c.find("URL").text())})}function _(a){c.trace("Pets-Client-Chat::ChatConnection::JoinMucRoom"),Gb.send(w.pres({from:Gb.jid,to:db(a)}).c("x",{xmlns:Fb.NS.MUC}).up().c("name").t(Ab.nickName))}function ab(a){c.trace("Pets-Client-Chat::ChatConnection::determineChatTypeFromAddress");var b=a.indexOf("@");return"conference"===a.substring(b+1,a.indexOf(".",b)).toLowerCase()?t.Muc:t.OneOnOne}function bb(a){return ab(a)===t.Muc}function cb(){c.trace("Pets-Client-Chat::ChatConnection::broadcastPresence");var a=w.pres();a=a.c("status").t(Hb).up(),Gb.send(a)}function db(a){return c.trace("Pets-Client-Chat::ChatConnection::getMucJid"),eb(a)+"/"+Fb.getNodeFromJid(Gb.jid)}function eb(a){return c.trace("Pets-Client-Chat::ChatConnection::getRoomJid"),Fb.getBareJidFromJid(a)}function fb(a){c.trace("Pets-Client-Chat::ChatConnection::getAffectedUserBareJid","roomJid = ",a);var b=Fb.getResourceFromJid(a),d=null;return null!==b&&(d=b+"@"+Fb.getDomainFromJid(Gb.jid)),c.trace("Pets-Client-Chat::ChatConnection::getAffectedUserBareJid","bareJid = ",d),d}function gb(a,c){var d=b.searchObjectArray(Ib,"room",a);return-1===d||"admin"===c}function hb(c,d){var e=b.searchObjectArray(Ib,"room",c),f=a.inArray(Fb.getBareJidFromJid(d),Ib[e].participants);Gb.send(w.iq({to:c,from:Gb.jid,type:"set",id:Gb.getUniqueId("adminset")}).c("query",{xmlns:Fb.NS.MUC+"#admin"}).c("item",{jid:d,affiliation:"admin"})),Ib[e].participants.splice(f,1),0===Ib[e].participants.length&&Ib.splice(e,1)}function ib(a,b){c.trace("Pets-Client-Chat::ChatConnection::sendMucInvites");for(var d=0,e=b.length;e>d;d++)Gb.send(w.msg({to:a}).c("x",{xmlns:Fb.NS.MUC+"#user"}).c("invite",{to:b[d]}))}function jb(a,d){return c.trace("Pets-Client-Chat::ChatConnection::createMucRoomName"),d?k.jidify(a,d)+"@conference."+Fb.getDomainFromJid(Gb.jid):b.generateRandomString(Fb.getNodeFromJid(Gb.jid),"@conference."+Fb.getDomainFromJid(Gb.jid))}function kb(a,d){c.trace("Pets-Client-Chat::ChatConnection::parseError");var e,f=a.attr("code"),g=a.attr("type"),h=a.find('[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').get(0).tagName;switch(h.toLowerCase()){case"bad-request":e="XML is malformed or cannot be processed.";break;case"conflict":e="Existing resource or session conflicts with name or address.";break;case"feature-not-implemented":e="Requested feature is not implemented.";break;case"forbidden":e="Requesting entity does not posses the required permissions.";break;case"gone":e="Recipient or server cannot be contacted at this address.";break;case"internal-server-error":e="An internal server error occurred.";break;case"item-not-found":e="The addressed JID or item requested cannot be found.";break;case"jid-malformed":e="JID or resource identifier is malformed.";break;case"not-acceptable":e="Request refused to be processed because it does not meet criteria.";break;case"not-allowed":e="Action not permitted.";break;case"not-authorized":e="Invalid or missing credentials.";break;case"payment-required":e="Payment required for requested service.";break;case"recipient-unavailable":e="The intended recipient is temporarily unavailable.";break;case"redirect":e="Requests for this information are being redirected.";break;case"registration-required":e="Registration is required to access the requested service.";break;case"remote-server-not-found":e="A remote server or service does not exist.";break;case"remote-server-timeout":e="A remote server or service could not be contacted within the timeout window.";break;case"resource-constraint":e="The server or recipient lacks the system resources necessary to service the request.";break;case"service-unavailable":e="The server or recipient does not currently provide the requested service.";break;case"subscription-required":e="A subscription is required to access the requested service.";break;case"undefined-condition":e="Unknown error.";break;case"unexpected-request":e="Request out of order."}c.error("Pets-Client-Chat::ChatConnection::ParseError",b.formatString("{0} [ {1} : {2} ] {3}",d,f,g,h))}function lb(){pb("strophe failed as Authentication failed")}function mb(){pb("roster null")}function nb(a){pb(a.errorCondition===p.Conflict?"strophe failed as connection replaced":"strophe failed due to connection error:"+a.statusCode)}function ob(){pb("Chat could NOT reconnect after max retry attempts")}function pb(a){u.getSecurityContext(function(b){g.logMessage({pet:"CHATCLIENT",petsId:b.bareJid,thumb:"",sid:b.sid,message:a})})}function qb(a,d){c.trace("Pets-Client-Chat::ChatConnection::onConnectionChanged("+a+", "+d+")");var e={statusCode:o.Unknown,errorCondition:p.Unknown,errorConditionText:d};switch(b.isUndefinedOrNull(d)||d===q.Conflict&&(Jb=!0),a){case Fb.Status.AUTHFAIL:c.error("Pets-Client-Chat::ChatConnection::onConnectionChanged","Authentication with chat server failed."),e.statusCode=o.AuthenticationFailed,k.postConnectionChanged(yb,e.statusCode,b.getObjPropNameByValue(o,e.statusCode),e.errorCondition,e.errorConditionText),lb(),x.clear(yb);break;case Fb.Status.DISCONNECTED:c.error("Pets-Client-Chat::ChatConnection::onConnectionChanged","Disconnected from chat server."),e.statusCode=o.Disconnected,Jb?(e.errorCondition=p.Conflict,e.errorConditionText=q.Conflict):zb.isSetOffline&&(e.errorCondition=p.None,e.errorConditionText=q.None),k.postConnectionChanged(yb,e.statusCode,b.getObjPropNameByValue(o,e.statusCode),e.errorCondition,e.errorConditionText),zb.isSetOffline||(Lb?mb():nb(e)),x.clear(yb),Lb=!1,Jb||zb.isSetOffline||P(),Jb=!1;break;case Fb.Status.CONNECTED:c.info("Pets-Client-Chat::ChatConnection::onConnectionChanged","Connected to chat server."),x.resetWindow(),e.statusCode=o.Connected,J(),k.postConnectionChanged(yb,e.statusCode,b.getObjPropNameByValue(o,e.statusCode),e.errorCondition,e.errorConditionText),Cb=0,R(),Z();break;case Fb.Status.ATTACHED:c.info("Pets-Client-Chat::ChatConnection::onConnectionChanged","Attached to chat server."),x.resetWindow(),e.statusCode=o.Attached,J(),Kb?(Kb=!1,Cb=0,R(),Z(),k.postConnectionChanged(yb,e.statusCode,b.getObjPropNameByValue(o,e.statusCode),e.errorCondition,e.errorConditionText)):y.get(yb,function(a){a?(k.postConnectionChanged(yb,e.statusCode,b.getObjPropNameByValue(o,e.statusCode),e.errorCondition,e.errorConditionText),Z()):(Lb=!0,N("roster null"))})}}function rb(e){c.trace("Pets-Client-Chat::ChatConnection::onRoster","",e,c.DataTypes.Xml);var f,g,h,i,j,l=[],m=[];try{a(e).find("item").each(function(c,e){if(f=a(e),j=f.attr("jid"),g=[],j!==Fb.getBareJidFromJid(Gb.jid)){f.find("group").each(function(c,d){i=k.getContactGroupInfo(a(d).text()),g.push(i.name),h=b.getObjectFromObjectArray(l,"name",i.name),null===h&&(h={name:i.name,displayName:i.displayName,type:i.type,classId:i.classId,contactJids:[]},l.push(h)),h.contactJids.push(j)});var n=j.match(/^([^@]*)@/),o=n?n[1]:j;d.vanityUrl.match(/profile.html/g)||(o=j),m.push({jid:j,name:f.attr("name"),groups:g,avatarUrl:f.attr("apollo:img"),profileUrl:b.formatString(d.vanityUrl,o)})}}),cb(),n.postContactsReceived(m,l)}catch(o){c.error("Pets-Client-Chat::ChatConnection::onRoster",b.formatString('An unexpected error occurred while parsing roster: "{0}"',o.message+!b.isUndefinedOrNull(o.stack)?"${nl}Stack Trace:${nl}"+o.stack:""))}return!0}function sb(d){c.trace("Pets-Client-Chat::ChatConnection::onRosterUpdate","",d,c.DataTypes.Xml);var e,f,g=a(d),h=g.find("item"),i=h.attr("jid"),j=[];try{g.find("item").each(function(b,d){h=a(d),"remove"===h.attr("subscription").toLowerCase()?(c.trace("Pets-Client-Chat::ChatConnection::onRosterUpdate","calling postContactsRemoved, jid = ",i),n.postContactRemoved(i)):(h.find("group").each(function(b,c){e=k.getContactGroupInfo(a(c).text()),j.push(e.name)}),c.trace("Pets-Client-Chat::ChatConnection::onRosterUpdate","calling postContactsChanged, jid = "+i+", groups = ",j),n.postContactChanged(i,h.attr("name"),f,j))})}catch(l){c.error("Pets-Client-Chat::ChatConnection::onRosterUpdate",b.formatString('An unexpected error occurred while parsing roster update: "{0}"',l.message+!b.isUndefinedOrNull(l.stack)?"${nl}Stack Trace:${nl}"+l.stack:""))}return!0}function tb(d){c.trace("Pets-Client-Chat::ChatConnection::onSidRid","",d,c.DataTypes.Xml);var e=a(d),f=e.attr("sid"),g=e.attr("rid");b.isUndefinedOrNull(f)||b.isUndefinedOrNull(g)||Jb||x.set(Fb.getBareJidFromJid(Gb.jid),f,g)}function ub(d){c.trace("Pets-Client-Chat::ChatConnection::onActivity","",d,c.DataTypes.Xml);try{var e,f=a(d),g=f.find('[xmlns="http://jabber.org/protocol/chatstates"]').get(0).tagName,h=f.attr("from"),i=Fb.getBareJidFromJid(h),j=bb(h);if("error"!==f.attr("type").toLowerCase()){switch(g.toLowerCase()){case"composing":e=s.Composing;break;case"paused":e=s.Paused;break;case"inactive":e=s.Inactive;break;case"gone":e=s.Gone;break;case"active":default:e=s.Active}j?e!==e.Gone&&m.postMucStateChanged(Fb.getBareJidFromJid(h),fb(h),e,b.getObjPropNameByValue(s,e)):m.postStateChanged(i,e,b.getObjPropNameByValue(s,e))}}catch(k){c.error("Pets-Client-Chat::ChatConnection::onActivity",b.formatString('An unexpected error occurred while parsing activity: "{0}"',k.message+!b.isUndefinedOrNull(k.stack)?"${nl}Stack Trace:${nl}"+k.stack:""))}return!0}function vb(d){c.trace("Pets-Client-Chat::ChatConnection::onPresence","",d,c.DataTypes.Xml);try{var e,f,g,h,i=a(d),j=i.attr("from"),l=i.attr("type"),n=i.find("show").text(),o=i.find("status").length>0?i.find("status").text():null,p=Fb.getBareJidFromJid(j),q=bb(j),s=[],t=Fb.getBareJidFromJid(Gb.jid);if("Replaced by new connection"===o&&(o=null),b.isUndefinedOrNull(l)||"error"!==l.toLowerCase()){if(b.isUndefinedOrNull(l)||!/subscribe/.test(l))if(q&&j===db(j))i.find("x status").each(function(b,c){s.push(a(c).attr("code"))}),a.inArray("100",s)>=0&&"unavailable"!==l&&k.postUserJoinedMuc(p),a.inArray("201",s)>=0&&(k.postMucRoomCreated(p),h=b.searchObjectArray(Ib,"room",p),h>=0&&!b.isUndefinedOrNull(Ib[h].participants)&&ib(p,Ib[h].participants));else{if(i.find("name").length>0&&(g=i.find("name").text()),b.isUndefinedOrNull(l)||0===l.length)if(0===n.length||"chat"===n.toLowerCase())f=r.Available;else switch(n.toLowerCase()){case"away":f=r.Away;break;case"xa":f=r.ExtendedAway;break;case"dnd":f=r.DoNotDisturb}else"unavailable"===l.toLowerCase()&&(f=r.Offline);q?(e=i.find("x item"),j=e.attr("jid"),gb(p,e.attr("affiliation").toLowerCase())||hb(p,j),m.postMucPresenceChanged(p,Fb.getBareJidFromJid(j),f,b.getObjPropNameByValue(r,f),g,o)):p===t?m.postSelfPresenceChanged(p,f,b.getObjPropNameByValue(r,f),o):m.postPresenceChanged(p,f,b.getObjPropNameByValue(r,f),o)}}else kb(i.find("error"),"Pets-Client-Chat::ChatConnection::onPresence",{from:j})}catch(u){c.error("Pets-Client-Chat::ChatConnection::onPresence",b.formatString('An unexpected error occurred while parsing presence: "{0}"',u.message+!b.isUndefinedOrNull(u.stack)?"${nl}Stack Trace:${nl}"+u.stack:""))}return!0}function wb(d){c.trace("Pets-Client-Chat::ChatConnection::onMessage","",d,c.DataTypes.Xml);try{var e,f,g,h,i=a(d),j=i.find("body"),k=i.find("html"),m=i.find("delay"),n=i.attr("from"),o=Fb.getBareJidFromJid(n),p=bb(n),q=!1,r=function(a){var b=[];if(3===a.nodeType||4===a.nodeType)b.push(4===a.nodeType?"<![CDATA["+a.data+"]]>":a.data);else{if(b.push("<"+a.tagName),a.attributes)for(var c=0,d=a.attributes.length;d>c;c++)b.push(" "+a.attributes[c].name+'="'+a.attributes[c].value+'"');b.push(">");for(var c=0,d=a.childNodes.length;d>c;c++)b.push(r(a.childNodes[c]));b.push("</"+a.tagName+">")}return b.join("")};if(j.length>0&&"error"!==i.attr("type").toLowerCase()){if(0===k.length)g=j.text();else{h=k.contents(),g=[];for(var s=0,t=h.length;t>s;s++)g.push(r(h[s]));g=g.join("")}m.length>0?(q=!b.isUndefinedOrNull(m.attr("stamp")),f=new Date(m.attr("stamp"))):f=new Date,p?(e=null!=Fb.getResourceFromJid(n)?o:n,c.trace("Pets-Client-Chat::ChatConnection::onMessage","postMucMessageReceived: "+g),l.postMucMessageReceived(e,fb(n),g,f,q)):(c.trace("Pets-Client-Chat::ChatConnection::onMessage","postMessageReceived: "+g),l.postMessageReceived(o,g,f,q))}}catch(u){c.error("Pets-Client-Chat::ChatConnection::onMessage",b.formatString('An unexpected error occurred while parsing message: "{0}"',u.message+!b.isUndefinedOrNull(u.stack)?"${nl}Stack Trace:${nl}"+u.stack:""))}return!0}function xb(d){c.trace("Pets-Client-Chat::ChatConnection::onMucInvite","",d,c.DataTypes.Xml);try{var e,f=a(d),g=f.find('x[xmlns="jabber:x:conference"]');e=g.length>0?g.attr("jid"):f.attr("from"),_(e)}catch(h){c.error("Pets-Client-Chat::ChatConnection::onMucInvite",b.formatString('An unexpected error occured while parsing MUC invite: "{0}"',h.message+!b.isUndefinedOrNull(h.stack)?"${nl}Stack Trace:${nl}"+h.stack:""))}return!0}c.trace("Pets-Client-Chat::ChatConnection::ctor");var yb,zb,Ab,Bb=e.create("chatConnection.messageQueue"),Cb=0,Db="chatconnection.options.",Eb="chatconnection.selfvcard.",Fb=w.strophe,Gb=new Fb.Connection(d.boshServiceUrl),Hb="",Ib=[],Jb=!1,Kb=!1,Lb=!1;return k.connectRequested(z),k.disconnectRequested(A),l.sendMessage(B),m.stateChangeRequested(C),m.presenceChangeRequested(D),k.createMuc(E),k.createNamedMuc(F),k.joinMucRoom(G),k.addUsersToMuc(H),k.leaveMuc(I),f.getHasCompletedSuccessfully()?L():f.completed(function(a,d){return d.status?void L():(c.fatal("PETs-Client-Chat::ChatConnection::onUserInfoCompleted","UserInfo data not retrieved, cannot connect to XMPP server."),void k.postConnectionChanged(yb,o.Error,b.getObjPropNameByValue(o,o.Error),p.UserUnknown,"User Unknown"))}),Gb.xmlOutput=function(b){var c=a(b);"body"===c.get(0).tagName.toLowerCase()&&c.attr("xmlns")==Fb.NS.HTTPBIND&&tb(b)},{}});

define("pets-client-chat/1.10.0/public/javascript/chatconnection", ["pets-client-chat/1.10.0/public/javascript/chatconnection.bundle"], function(temp){
  return temp;
});

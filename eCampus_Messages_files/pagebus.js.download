define([],function(){window.OpenAjax||(OpenAjax=new function(){var a="org.openajax.hub.",b={};this.hub=b,b.implementer="http://openajax.org",b.implVersion="2.0",b.specVersion="2.0",b.implExtraData={};var c={};b.libraries=c,b.registerLibrary=function(b,d,e,f){c[b]={prefix:b,namespaceURI:d,version:e,extraData:f},this.publish(a+"registerLibrary",c[b])},b.unregisterLibrary=function(b){this.publish(a+"unregisterLibrary",c[b]),delete c[b]},b._subscriptions={c:{},s:[]},b._cleanup=[],b._subIndex=0,b._pubDepth=0,b.subscribe=function(a,b,c,d,e){c||(c=window);var f=a+"."+this._subIndex,g={scope:c,cb:b,fcb:e,data:d,sid:this._subIndex++,hdl:f},h=a.split(".");return this._subscribe(this._subscriptions,h,0,g),f},b.publish=function(a,b){var c=a.split(".");if(this._pubDepth++,this._publish(this._subscriptions,c,0,a,b),this._pubDepth--,this._cleanup.length>0&&0===this._pubDepth){for(var d=0;d<this._cleanup.length;d++)this.unsubscribe(this._cleanup[d].hdl);delete this._cleanup,this._cleanup=[]}},b.unsubscribe=function(a){var b=a.split("."),c=b.pop();this._unsubscribe(this._subscriptions,b,0,c)},b._subscribe=function(a,b,c,d){var e=b[c];c==b.length?a.s.push(d):("undefined"==typeof a.c&&(a.c={}),"undefined"==typeof a.c[e]?(a.c[e]={c:{},s:[]},this._subscribe(a.c[e],b,c+1,d)):this._subscribe(a.c[e],b,c+1,d))},b._publish=function(a,b,c,d,e,f){if("undefined"!=typeof a){var g;if(c==b.length?g=a:(this._publish(a.c[b[c]],b,c+1,d,e,f),this._publish(a.c["*"],b,c+1,d,e,f),g=a.c["**"]),"undefined"!=typeof g)for(var h=g.s,i=h.length,j=0;i>j;j++)if(h[j].cb){var k=h[j].scope,l=h[j].cb,m=h[j].fcb,n=h[j].data;"string"==typeof l&&(l=k[l]),"string"==typeof m&&(m=k[m]),(!m||m.call(k,d,e,n))&&l.call(k,d,e,n,f)}}},b._unsubscribe=function(a,b,c,d){if("undefined"!=typeof a){if(c<b.length){var e=a.c[b[c]];if(this._unsubscribe(e,b,c+1,d),0===e.s.length){if(0===e.c.length)return;delete a.c[b[c]]}return}for(var f=a.s,g=f.length,h=0;g>h;h++)if(d==f[h].sid)return this._pubDepth>0?(f[h].cb=null,this._cleanup.push(f[h])):f.splice(h,1),void 0}}},OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","1.0",{})),window.PageBus||(PageBus=new function(){var a=0,b=[],c=this;this.version="2.0.0",this._debug=function(){window["debugger"]},_badParm=function(){throw new Error("OpenAjax.hub.Errors.BadParameters")},_valPub=function(a){(null===a||-1!=a.indexOf("*")||-1!=a.indexOf("..")||"."==a.charAt(0)||"."==a.charAt(a.length-1))&&_badParm()},_valSub=function(a){for(var b=a.split("."),c=b.length,d=0;c>d;d++)(""===b[d]||-1!=b[d].indexOf("*")&&"*"!=b[d]&&"**"!=b[d])&&_badParm(),"**"==b[d]&&c-1>d&&_badParm();return b},_cacheIt=function(a){return a&&"object"==typeof a&&a.PageBus&&a.PageBus.cache},_TopicMatcher=function(){this._items={}},_TopicMatcher.prototype.store=function(a,b){var c=a.split("."),d=c.length;_recurse=function(e,f){if(f==d)e["."]={topic:a,value:b};else{var g=c[f];e[g]||(e[g]={}),_recurse(e[g],f+1)}},_recurse(this._items,0)},_TopicMatcher.prototype.match=function(a,b){var c=a.split("."),d=c.length,e=[];return _recurse=function(a,f){if(a){var g;if(f==d)g=a;else{if(_recurse(a[c[f]],f+1),b)return;"**"!=c[f]&&_recurse(a["*"],f+1),g=a["**"]}g&&g["."]&&e.push(g["."])}},_recurse(this._items,0),e},_TopicMatcher.prototype.exists=function(a,b){var c=a.split("."),d=c.length,e=!1;return _recurse=function(a,f){if(a){var g;if(f==d)g=a;else{if(_recurse(a[c[f]],f+1),e||b)return;if("**"!=c[f]&&(_recurse(a["*"],f+1),e))return;g=a["**"]}g&&g["."]&&(e=!0)}},_recurse(this._items,0),e},_TopicMatcher.prototype.clear=function(a){var b=a.split("."),c=b.length;_recurse=function(a,d){if(a)if(d==c)a["."]&&delete a["."];else{if(_recurse(a[b[d]],d+1),0===a[b[d]].length)return;delete a[b[d]]}},_recurse(this._items,0)},_TopicMatcher.prototype.wildcardMatch=function(a){var b=a.split("."),c=b.length,d=[];return _recurse=function(a,e){var f,g=b[e],h=null;if(a&&e!=c)if("**"==g)for(h in a)"."!=h&&(f=a[h],f["."]&&d.push(f["."]),_recurse(f,e));else if("*"==g)for(h in a)"."!=h&&"**"!=h&&(f=a[h],e==c-1?f["."]&&d.push(f["."]):_recurse(f,e+1));else{if(f=a[g],!f)return;e==c-1?f["."]&&d.push(f["."]):_recurse(f,e+1)}},_recurse(this._items,0),d},this._refs={},this._doCache=new _TopicMatcher,this._caches=new _TopicMatcher,_isCaching=function(a){return c._doCache.exists(a,!1)},_copy=function(a){var b;if("object"==typeof a){if(null===a)return null;if(a.constructor==Array){b=[];for(var c=0;c<a.length;c++)b[c]=_copy(a[c]);return b}if(a.constructor==Date)return b=new Date,b.setDate(a.getDate()),b;b={};for(var d in a)b[d]=_copy(a[d]);return b}return a},this._add=function(a,b){var c,d=this._doCache.match(a,!0);d.length>0?c=d[0].value:(c={rc:0},this._doCache.store(a,c)),c.rc++,this._refs[b]=a},this._remove=function(a){var b=this._refs[a];if(b){delete this._refs[a];var c=this._doCache.match(b,!0);if(0!==c.length&&(c[0].value.rc--,0===c[0].value.rc)){this._doCache.clear(b);for(var d=this._caches.wildcardMatch(b),e=0;e<d.length;e++)this._doCache.exists(d[e].topic,!1)||this._caches.clear(d[e].topic)}}},this.subscribe=function(a,b,c,d){d||(d=null);var e=OpenAjax.hub.subscribe(a,c,b,d);if(_cacheIt(d)){this._add(a,e);for(var f=this.query(a),g=0;g<f.length;g++)try{c.call(b?b:window,f[g].topic,f[g].value,d)}catch(h){PageBus._debug()}}return e},this.publish=function(c,d){if(_valPub(c),b.push({n:c,m:d,d:a+1}),_isCaching(c))try{this._caches.store(c,d)}catch(e){_badParm()}if(0===a)for(;b.length>0;){var f=b.shift();try{a=f.d,OpenAjax.hub.publish(f.n,f.m),a=0}catch(g){throw a=0,g}}},this.unsubscribe=function(a){try{this._remove(a),OpenAjax.hub.unsubscribe(a)}catch(b){_badParm()}},this.store=function(a,b){if(!_isCaching(a))throw new Error("PageBus.cache.NoCache");this.publish(a,b)},this.query=function(a){try{return _valSub(a),this._caches.wildcardMatch(a)}catch(b){_badParm()}}},OpenAjax.hub.registerLibrary("PageBus","http://tibco.com/PageBus","1.2.0",{}));var a=PageBus.publish,b=[],c=function(a){for(var c=0;c<b.length;c++)b[c](a)};PageBus.onMessage=function(a){b.push(a)},PageBus.publish=function(b,d){var e=arguments;setTimeout(function(){a.apply(PageBus,e)},1),setTimeout(function(){c(d)},15)};var d=function(a){return function(b){PageBus.publish("logger."+a,{body:b})}};return window.Logger={trace:d("trace"),debug:d("debug"),info:d("info"),warn:d("warn"),error:d("error"),fatal:d("fatal")},PageBus});
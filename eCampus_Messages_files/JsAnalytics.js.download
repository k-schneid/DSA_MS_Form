define(["ncf-messaging/1.0.1/public/javascript/pagebus","ncf-instrumentation/1.0.1/public/javascript/GAPlugin","ncf-instrumentation/1.0.1/public/javascript/AdobePlugin"],function(a,b){function c(a,b,c,d,e,f,g,h,i){this.setApplicationId(a),this.setCommand(b),this.setEventType(c),this.setLevel(d),this.setParameters(e),this.setSessionId(f),this.setSource(g),this.setTimeStamp(h),this.setProfileId(i),this.toString=function(){var a="[",b=!0;for(var c in this)"function"!=typeof this[c]&&(b||(a+=", "),a+=c+":"+this[c],b=!1);return a+="]"}}function d(){}function e(a){if(!a.getId()||!a.getName())return!1;for(var b=0;b<l.length;b++)if(l[b].getId()==a.getId())throw new Error("The id already exists! "+a.getId());return!0}function f(a,b){k&&window.console&&(b||(b="info"),window.console[b](a))}function g(a){if("object"==typeof a){var b="{",c=!0;for(var d in a)c||(b+=", "),b+='"'+d+'"'+":"+'"'+a[d]+'"',c=!1;return b+="}"}return a}function h(a){throw isLogAvailable()&&f(a+" not implemented","error"),new Error(a+" not implemented")}function i(a){var b;return(b=new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?b[1]:null}function j(a){var b,c={};return"undefined"!=typeof a.fullEventId&&(b=a.fullEventId,c.applicationId=-1!==b.indexOf("chat")?"PETS-Client-Chat":a.fullEventId,c.sourceId=a.source,c.command=a.fullEventId,c.parameters=a.payload,c.profileId=a.userId,c.logLevel="undefined"!==a.level?a.level:"INFO",c.eventType="undefined"!==a.eventType?a.eventType:"user"),c}var k=-1!=window.location.search.toString().indexOf("debug=true"),l=[],m=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"],n=["user","system","history"];c.prototype={getApplicationId:function(){return this.applicationId},setApplicationId:function(a){if("undefined"==typeof a)throw new Error("applicationId is required.");this.applicationId=a},getCommand:function(){return this.command},setCommand:function(a){if("undefined"==typeof a)throw new Error("Command should be passed!");if(/\s/.test(a))throw new Error("Can not have spaces in command! Command: "+a);this.command=a},getEventType:function(){return this.eventType},setEventType:function(a){if("undefined"==typeof a)return this.eventType=n[0],void 0;if(n.indexOf(a)<0)throw new Error("Not an allowed eventType, allowed eventTypes are: 'user', 'system', 'history'");this.eventType=a},getLevel:function(){return this.level},setLevel:function(a){if("undefined"==typeof a)return this.level=m[2],void 0;if(m.indexOf(a)<0)throw new Error("Not an allowed level, allowed levels are ['TRACE', 'DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL']");this.level=a},getParameters:function(){return this.parameters},setParameters:function(a){"undefined"!=typeof a&&(this.parameters=a)},getSessionId:function(){return this.sessionId},setSessionId:function(a){"undefined"!=typeof a&&(this.sessionId=a)},getSource:function(){return this.source},setSource:function(a){"undefined"!=typeof a&&(this.source=a)},getTimeStamp:function(){return this.timeStamp},setTimeStamp:function(a){"undefined"!=typeof a&&(this.timeStamp=a)},getProfileId:function(){return this.profileId},setProfileId:function(a){"undefined"!=typeof a&&(this.profileId=a)}};var o=function(){};o.prototype={getId:function(){h("getId")},getName:function(){h("getName")},callback:function(){h("callback")},getCommands:function(){return[]},toString:function(){return"getId(): "+this.getId()+", getName(): "+this.getName()+", getCommands(): "+this.getCommands()}},d.prototype={bind:function(a){if(!(a instanceof o))throw f("The plugin passed in does not implement PluginAddOn"),new Error("The plugin passed in does not implement PluginAddOn");e(a)&&l.push(a)},unbind:function(a){if(!(a instanceof o))throw f("The plugin passed in does not implement PluginAddOn"),new Error("The plugin passed in does not implement AnalysisPlugin");if(-1!=l.indexOf(a)){for(var b=-1,c=0;c<l.length;c++)if(l[c]===a){b=c;break}b>=0&&l.splice(b,1),l.splice(l.indexOf(a),1)}else f("The PluginAddOn requested could not be found.")},sendItems:function(a){if(null!==a)for(var b=0;b<l.length;b++){var c=l[b],d=new RegExp(c.getCommands().join("|"));if(c.getCommands().length>0)for(var e=0;e<a.length;e++)null!==a[e].getCommand().match(d)&&c.callback(a);else c.callback(a)}},send:function(a,b,d,e,f,g,h,i,j){var k=[new c(a,b,f,g,d,i,e,h,j)];this.sendItems(k)},hashCode:function(a){var b,c,d=0;if(0===a.length)return d;for(b=0,c=a.length;c>b;b++){var e=a.charCodeAt(b);d=(d<<5)-d+e,d&=d}return d}},d.prototype.AddOn=o,d.prototype.log=f,d.prototype.InstrumentationItem=c,d.prototype.stringify=g,d.prototype.listPlugins=function(){return l},k&&(d.prototype.logPlugins=function(){for(var a=0;a<l.length;a++)f(l[a].toString())}),Array.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1});var p=new d;try{a.onMessage(function(a){"undefined"!=typeof a&&(a=j(a),"undefined"!=typeof a.applicationId&&"undefined"!=typeof a.command&&p.send(a.applicationId,a.command,a.parameters,a.sourceId,a.eventType,a.logLevel,(new Date).toUTCString(),i("APOLLOSSOZCOOKIE"),a.profileId||a.analyticsId))})}catch(q){console&&console.error(q)}return b.init(p),p});